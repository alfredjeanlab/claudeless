# Capture Edit tool permission dialog.
# Requires API call - Claude must decide to use Edit tool.
# Note: Requires KEYBOARD_TIMEOUT=120 or longer (API response time varies).
# Run with: KEYBOARD_TIMEOUT=120 ./tests/capture/capture.sh --script edit-permission-dialog
# Args: --model haiku

# Handle trust dialog if it appears, then wait for ready state
if wait "trust this folder" 5s
    send <Enter>
    wait "for shortcuts" 10s
else
    wait "for shortcuts" 10s
end

# Ask Claude to edit an existing file (README.md exists in project)
send "Edit README.md and add a line at the end that says: # Test Line"
wait 100
send <Enter>

# Wait for Edit permission dialog to appear
wait "Edit file" 120s
wait "Do you want to make this edit" 10s
snapshot "edit_permission_dialog"

# Cancel and exit cleanly
send <Esc>
wait 500
send <C-u> 100 "/exit" 100 <Enter>
wait 500
kill TERM
