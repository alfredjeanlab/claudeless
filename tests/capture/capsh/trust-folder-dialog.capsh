# Capture trust folder dialog when accessing external directory.
# Requires API call - Claude must decide to access an external folder.
# Args: --model haiku
# Timeout: 60

# Handle initial trust dialog if it appears, then wait for ready state
if wait "trust this folder" 5s
    send <Enter>
    wait "for shortcuts" 3s
else
    wait "for shortcuts" 3s
end

# Ask Claude to access an external folder (outside project directory)
send "list files in ~/Downloads"
wait 100
send <Enter>

# Wait for permission dialog to appear - could be bash or trust folder
# Match handles both types of dialogs
match 45s
    "Do you want to proceed" -> snapshot "trust_folder_dialog"
    "Do you want to trust" -> snapshot "trust_folder_dialog"
    "trust.*Downloads" -> snapshot "trust_folder_dialog"
end

# Cancel and exit cleanly
send <Esc>
wait 500
send <C-u> 100 "/exit" 100 <Enter>
wait 500
kill TERM
